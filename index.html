<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Proveedor - SPI Américas</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Inter", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        line-height: 1.4;
        --primary: #005f73;
        --primary-light: #0a9396;
        --primary-dark: #003845;
        --surface: #f7fafc;
        --border: #d9e2ec;
        --accent: #94d2bd;
        --danger: #c1121f;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        background: var(--surface);
        color: #1f2933;
      }

      header {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        padding: 2.5rem 1.5rem;
        text-align: center;
      }

      header h1 {
        margin: 0 0 0.5rem;
        font-size: clamp(1.8rem, 4vw, 2.6rem);
      }

      header p {
        margin: 0;
        font-size: 1.05rem;
        opacity: 0.9;
      }

      main {
        max-width: 1100px;
        margin: -3rem auto 4rem;
        padding: 0 1.5rem 4rem;
      }

      .card {
        background: white;
        border-radius: 18px;
        padding: 2rem;
        box-shadow: 0 25px 60px -35px rgba(15, 23, 42, 0.45);
        border: 1px solid rgba(15, 23, 42, 0.04);
        margin-bottom: 2rem;
      }

      h2 {
        margin-top: 0;
        color: var(--primary-dark);
        font-size: 1.5rem;
      }

      h3 {
        margin-top: 2.5rem;
        color: var(--primary);
      }

      .grid {
        display: grid;
        gap: 1.25rem;
      }

      .grid.two {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }

      .grid.three {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }

      label {
        font-weight: 600;
        display: block;
        margin-bottom: 0.35rem;
      }

      label span {
        color: var(--danger);
        font-size: 0.85rem;
        margin-left: 0.25rem;
      }

      input[type="text"],
      input[type="email"],
      input[type="tel"],
      input[type="url"],
      input[type="date"],
      textarea,
      select {
        width: 100%;
        padding: 0.75rem 0.85rem;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: #f9fbfd;
        font-size: 0.95rem;
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }

      textarea {
        resize: vertical;
        min-height: 120px;
      }

      input:focus,
      textarea:focus,
      select:focus {
        border-color: var(--primary-light);
        outline: none;
        box-shadow: 0 0 0 3px rgba(148, 210, 189, 0.4);
      }

      .radio-group,
      .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: center;
      }

      .radio-group label,
      .checkbox-group label {
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      input[type="file"] {
        padding: 0.75rem 0.85rem;
        background: #fff;
        border: 2px dashed var(--border);
        border-radius: 12px;
      }

      .extracted-output {
        margin-top: 1rem;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: #f8fafc;
        padding: 1.25rem;
        font-size: 0.95rem;
      }

      .extracted-output dl {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0.75rem 1.25rem;
        margin: 0;
      }

      .extracted-output dt {
        font-weight: 600;
        color: var(--primary-dark);
      }

      .extracted-output dd {
        margin: 0;
        color: #27313d;
      }

      .contact-section {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 1.5rem;
        background: linear-gradient(180deg, rgba(148, 210, 189, 0.12), rgba(148, 210, 189, 0.02));
      }

      .contact-section h4 {
        margin: 0 0 1rem;
        color: var(--primary-dark);
      }

      .declarations {
        display: grid;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .declarations label {
        font-weight: 500;
      }

      button {
        margin-top: 2rem;
        padding: 0.95rem 1.75rem;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 999px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      button:hover {
        background: var(--primary-light);
        transform: translateY(-1px);
      }

      .helper-text {
        font-size: 0.85rem;
        color: #52606d;
        margin-top: 0.35rem;
      }

      .file-card {
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 1.5rem;
        background: rgba(148, 210, 189, 0.08);
      }

      @media (max-width: 720px) {
        main {
          margin-top: -2rem;
          padding: 0 1rem 3rem;
        }

        .card {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Alta de Proveedor - SPI Américas</h1>
      <p>
        Cargue los documentos legales de su empresa. Intentaremos precargar la
        información automáticamente para completar el formulario bilingüe.
      </p>
    </header>
    <main>
      <form id="supplierForm" novalidate>
        <section class="card" aria-labelledby="documentos">
        <h2 id="documentos">1. Carga de documentos</h2>
        <p>
          Suba el <strong>Certificado de constitución legal</strong> y el
          <strong>Documento de representación legal</strong>. La plataforma
          analizará el texto para sugerir los datos de su compañía.
        </p>
        <div class="grid two">
          <div class="file-card">
            <label for="certificateUpload">Certificado de constitución legal</label>
            <input id="certificateUpload" type="file" accept=".txt,.pdf,.doc,.docx,.rtf,.html,.htm" />
            <p class="helper-text">
              Se admite carga de archivos de texto o documentos. Para obtener
              mejores resultados, convierta los PDF escaneados a texto.
            </p>
            <div id="certificateOutput" class="extracted-output" aria-live="polite">
              Aún no se han extraído datos de este documento.
            </div>
          </div>
          <div class="file-card">
            <label for="representationUpload">Documento de representación legal</label>
            <input id="representationUpload" type="file" accept=".txt,.pdf,.doc,.docx,.rtf,.html,.htm" />
            <p class="helper-text">
              El contenido ayudará a completar la información del representante
              legal y los datos de contacto.
            </p>
            <div id="representationOutput" class="extracted-output" aria-live="polite">
              Aún no se han extraído datos de este documento.
            </div>
          </div>
        </div>
      </section>

        <section class="card" aria-labelledby="info-empresa">
        <h2 id="info-empresa">2. Información de la empresa / Company Information</h2>
        <div class="grid two">
          <div>
            <label>Tipo de tercero / Third-party Type<span>*</span></label>
            <div class="radio-group">
              <label>
                <input type="radio" name="thirdType" value="Cliente" /> Cliente / Customer
              </label>
              <label>
                <input type="radio" name="thirdType" value="Proveedor" checked /> Proveedor / Supplier
              </label>
            </div>
          </div>
          <div>
            <label>Tipo de persona / Entity Type<span>*</span></label>
            <div class="radio-group">
              <label>
                <input type="radio" name="entityType" value="Natural" /> Natural Person
              </label>
              <label>
                <input type="radio" name="entityType" value="Jurídica" checked /> Persona Jurídica / Legal Entity
              </label>
            </div>
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="businessName">Razón Social o Nombre Completo / Legal Name<span>*</span></label>
            <input id="businessName" type="text" placeholder="Ingrese la razón social" required />
          </div>
          <div>
            <label for="taxIdType">Identificación Fiscal / Tax ID Type</label>
            <input id="taxIdType" type="text" placeholder="NIT, RUT, RFC..." />
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="taxIdNumber">Número de Identificación / Tax ID Number<span>*</span></label>
            <input id="taxIdNumber" type="text" placeholder="Número de identificación fiscal" required />
          </div>
          <div>
            <label for="website">Página Web / Website</label>
            <input id="website" type="url" placeholder="https://empresa.com" />
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="fiscalAddress">Dirección Fiscal / Fiscal Address<span>*</span></label>
            <input id="fiscalAddress" type="text" placeholder="Dirección fiscal" required />
          </div>
          <div>
            <label for="physicalAddress">Dirección Física / Physical Address</label>
            <input id="physicalAddress" type="text" placeholder="Dirección física" />
          </div>
        </div>

        <div class="grid three">
          <div>
            <label for="country">País / Country<span>*</span></label>
            <input id="country" type="text" placeholder="País" required />
          </div>
          <div>
            <label for="region">Región / State</label>
            <input id="region" type="text" placeholder="Región / Estado" />
          </div>
          <div>
            <label for="mainActivity">Actividad principal / Main Activity</label>
            <input id="mainActivity" type="text" placeholder="Actividad económica" />
          </div>
        </div>

        <div class="grid three">
          <div>
            <label for="generalEmail">E-mail general / General Email<span>*</span></label>
            <input id="generalEmail" type="email" placeholder="correo@empresa.com" required />
          </div>
          <div>
            <label for="generalPhone">Teléfono fijo / Landline</label>
            <input id="generalPhone" type="tel" placeholder="Número de teléfono" />
          </div>
          <div>
            <label for="fax">Teléfono Fax / Fax Number</label>
            <input id="fax" type="tel" placeholder="Número de fax" />
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="invoiceReception">Radicación de facturas / Invoice Reception</label>
            <textarea id="invoiceReception" placeholder="Instrucciones o dirección para radicar facturas"></textarea>
          </div>
          <div>
            <label for="maxInvoiceDate">Fecha máxima de recibo mensual / Monthly Invoice Cut-off</label>
            <input id="maxInvoiceDate" type="date" />
          </div>
        </div>

        <h3>Representante Legal / Legal Representative</h3>
        <div class="grid two">
          <div>
            <label for="legalRepName">Nombre del representante / Representative Name<span>*</span></label>
            <input id="legalRepName" type="text" placeholder="Nombre completo" required />
          </div>
          <div>
            <label for="legalRepRole">Cargo / Position</label>
            <input id="legalRepRole" type="text" placeholder="Cargo del representante" />
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="legalRepPhone">Teléfono o celular / Phone</label>
            <input id="legalRepPhone" type="tel" placeholder="Número de contacto" />
          </div>
          <div>
            <label for="legalRepEmail">E-mail</label>
            <input id="legalRepEmail" type="email" placeholder="correo@ejemplo.com" />
          </div>
        </div>
      </section>

        <section class="card" aria-labelledby="contactos">
        <h2 id="contactos">3. Contactos de facturación / Billing Contacts</h2>
        <p>Complete la información de las personas responsables de los pagos.</p>

        <div class="grid two">
          <div class="contact-section">
            <h4>Cuentas por pagar / Accounts Payable<span>*</span></h4>
            <div class="grid two">
              <div>
                <label for="accountsPayableName">Nombre</label>
                <input id="accountsPayableName" type="text" placeholder="Nombre completo" />
              </div>
              <div>
                <label for="accountsPayableEmail">E-mail<span>*</span></label>
                <input id="accountsPayableEmail" type="email" placeholder="correo@empresa.com" required />
              </div>
            </div>
            <div class="grid two">
              <div>
                <label for="accountsPayablePhone">Teléfono</label>
                <input id="accountsPayablePhone" type="tel" placeholder="Número de contacto" />
              </div>
              <div>
                <label for="accountsPayableMobile">Celular</label>
                <input id="accountsPayableMobile" type="tel" placeholder="Número móvil" />
              </div>
            </div>
          </div>

          <div class="contact-section">
            <h4>Contacto financiero / Financial Contact</h4>
            <div class="grid two">
              <div>
                <label for="financeContactName">Nombre</label>
                <input id="financeContactName" type="text" placeholder="Nombre completo" />
              </div>
              <div>
                <label for="financeContactEmail">E-mail</label>
                <input id="financeContactEmail" type="email" placeholder="correo@empresa.com" />
              </div>
            </div>
            <div class="grid two">
              <div>
                <label for="financeContactPhone">Teléfono fijo</label>
                <input id="financeContactPhone" type="tel" placeholder="Teléfono fijo" />
              </div>
              <div>
                <label for="financeContactMobile">Celular</label>
                <input id="financeContactMobile" type="tel" placeholder="Número móvil" />
              </div>
            </div>
          </div>
        </div>

        <div class="contact-section" style="margin-top: 1.5rem;">
          <h4>Contacto directo / Primary Contact</h4>
          <div class="grid two">
            <div>
              <label for="directContactName">Nombre</label>
              <input id="directContactName" type="text" placeholder="Nombre completo" />
            </div>
            <div>
              <label for="directContactEmail">E-mail</label>
              <input id="directContactEmail" type="email" placeholder="correo@empresa.com" />
            </div>
          </div>
          <div class="grid two">
            <div>
              <label for="directContactPhone">Teléfono fijo</label>
              <input id="directContactPhone" type="tel" placeholder="Teléfono fijo" />
            </div>
            <div>
              <label for="directContactMobile">Celular</label>
              <input id="directContactMobile" type="tel" placeholder="Número móvil" />
            </div>
          </div>
        </div>
      </section>

        <section class="card" aria-labelledby="declaraciones">
        <h2 id="declaraciones">4. Declaraciones y autorizaciones</h2>
        <div class="declarations">
          <label>
            <input id="pepDeclaration" type="checkbox" required />
            Declaro que ni yo ni la entidad representada somos personas
            políticamente expuestas (PEP). / I declare that neither I nor the
            represented entity are politically exposed persons.
          </label>
          <label>
            <input id="accuracyDeclaration" type="checkbox" required />
            Certifico que la información suministrada es veraz y completa. /
            I certify that the information provided is truthful and complete.
          </label>
          <label>
            <input id="dataPolicy" type="checkbox" required />
            Acepto la política de tratamiento de datos personales de SPI
            Américas. / I accept SPI Américas' data processing policy.
          </label>
        </div>
          <button type="button" id="submitButton">Enviar solicitud / Submit</button>
          <p class="helper-text">
            Nunca envíe contraseñas ni información sensible a formularios no verificados.
            / Never submit passwords or sensitive data through unknown forms.
          </p>
        </section>
      </form>
    </main>

    <template id="extractedTemplate">
      <dl></dl>
    </template>

    <script>
      const fieldPatterns = [
        { id: "businessName", label: "Razón Social", regex: /Raz[oó]n Social[^\n]*\n+([^\n]+)/i },
        { id: "taxIdType", label: "Tipo de identificación fiscal", regex: /Identificaci[oó]n Fiscal[^\n]*\n+([^\n]+)/i },
        { id: "taxIdNumber", label: "Número de identificación", regex: /N[uú]mero de Identificaci[oó]n[^\n]*\n+([^\n]+)/i },
        { id: "fiscalAddress", label: "Dirección fiscal", regex: /Direcci[oó]n Fiscal[^\n]*\n+([^\n]+)/i },
        { id: "physicalAddress", label: "Dirección física", regex: /Direcci[oó]n F[ií]sica[^\n]*\n+([^\n]+)/i },
        { id: "country", label: "País", regex: /Pa[ií]s[^\n]*\n+([^\n]+)/i },
        { id: "region", label: "Regi[oó]n", regex: /Regi[oó]n[^\n]*\n+([^\n]+)/i },
        { id: "generalPhone", label: "Teléfono fijo", regex: /Tel[eé]fono\s*F[ií]jo[^\n]*\n+([^\n]+)/i },
        { id: "fax", label: "Fax", regex: /Tel[eé]fono\s*Fax[^\n]*\n+([^\n]+)/i },
        { id: "website", label: "Página web", regex: /P[aá]gina\s*Web[^\n]*\n+([^\n]+)/i },
        { id: "legalRepName", label: "Representante legal", regex: /Nombre del Representante Legal[^\n]*\n+([^\n]+)/i },
        { id: "legalRepRole", label: "Cargo representante", regex: /Cargo del Representante Legal[^\n]*\n+([^\n]+)/i },
        { id: "legalRepPhone", label: "Teléfono representante", regex: /Tel[eé]fono\s*o\s*Celular del Representante Legal[\s\S]*?(\+?[0-9][0-9\s()\-]{6,})/i },
        { id: "legalRepEmail", label: "E-mail representante", regex: /E-mail del Representante Legal[^\n]*\n+([^\n]+)/i },
        { id: "generalEmail", label: "E-mail", regex: /\*\s*E-mail\.?[^\n]*\n+([^\n@]+@[^\n]+)/i },
        { id: "mainActivity", label: "Actividad principal", regex: /Actividad principal[^\n]*\n+([^\n]+)/i },
        { id: "invoiceReception", label: "Radicación de facturas", regex: /Radicaci[oó]n de facturas[^\n]*\n+([\s\S]+?)(?=\n\s*(?:Fecha|\*|Nombre|Contacto|$))/i },
        { id: "maxInvoiceDate", label: "Fecha máxima recibo", regex: /Fecha m[aá]xima de recibo mensual[\s\S]*?(\d{1,2}[\s\/]+\d{1,2}[\s\/]+\d{2,4})/i },
        { id: "accountsPayableEmail", label: "Email cuentas por pagar", regex: /Contacto cuentas por pagar[\s\S]*?E-mail\.?\s*\n+([^\n]+)/i }
      ];

      const radioPatterns = [
        {
          name: "thirdType",
          options: [
            { value: "Cliente", regex: /Tipo de tercero[\s\S]*?Cliente\s*(?:✓|✔|X|SI|Sí|Selected)/i },
            { value: "Proveedor", regex: /Tipo de tercero[\s\S]*?Proveedor\s*(?:✓|✔|X|SI|Sí|Selected)/i }
          ]
        },
        {
          name: "entityType",
          options: [
            { value: "Natural", regex: /Tipo de Persona[\s\S]*?Natural\s*(?:✓|✔|X|SI|Sí|Selected)/i },
            { value: "Jurídica", regex: /Tipo de Persona[\s\S]*?Jur[ií]dica\s*(?:✓|✔|X|SI|Sí|Selected)/i }
          ]
        }
      ];

      const outputLabels = {
        businessName: "Razón Social",
        taxIdType: "Tipo ID Fiscal",
        taxIdNumber: "Número ID",
        fiscalAddress: "Dirección Fiscal",
        physicalAddress: "Dirección Física",
        country: "País",
        region: "Región",
        generalPhone: "Teléfono Fijo",
        fax: "Fax",
        website: "Página Web",
        legalRepName: "Representante Legal",
        legalRepRole: "Cargo",
        legalRepPhone: "Teléfono Representante",
        legalRepEmail: "Email Representante",
        generalEmail: "Email",
        mainActivity: "Actividad Principal",
        invoiceReception: "Radicación Facturas",
        maxInvoiceDate: "Fecha Máxima Recepción",
        accountsPayableEmail: "Email CxP"
      };

      const aggregations = {};

      function cleanValue(value) {
        if (!value) return "";
        return value.replace(/\s+/g, " ").replace(/\s*,\s*/g, ", ").trim();
      }

      function parseDate(raw) {
        if (!raw) return "";
        const sanitized = raw.replace(/\s+/g, "");
        const match = sanitized.match(/(\d{1,2})[\/](\d{1,2})[\/](\d{2,4})/);
        if (match) {
          const [_, day, month, year] = match;
          const formattedYear = year.length === 2 ? `20${year}` : year;
          const date = new Date(`${formattedYear}-${month.padStart(2, "0")}-${day.padStart(2, "0")}`);
          if (!isNaN(date.getTime())) {
            return date.toISOString().split("T")[0];
          }
        }
        return "";
      }

      function parseDocument(text) {
        if (!text) return {};
        const info = {};
        for (const { id, regex } of fieldPatterns) {
          const match = regex.exec(text);
          if (match && match[1]) {
            let value = cleanValue(match[1]);
            if (id === "maxInvoiceDate") {
              value = parseDate(match[1]);
            }
            if (value) {
              info[id] = value;
            }
          }
        }

        for (const { name, options } of radioPatterns) {
          for (const option of options) {
            if (option.regex.test(text)) {
              info[name] = option.value;
              break;
            }
          }
        }

        return info;
      }

      function fillForm(info) {
        Object.entries(info).forEach(([id, value]) => {
          if (id === "thirdType" || id === "entityType") {
            const radio = document.querySelector(`input[name="${id}"][value="${value}"]`);
            if (radio) {
              radio.checked = true;
            }
            return;
          }

          const element = document.getElementById(id);
          if (!element) return;

          if (element.type === "date" && value) {
            element.value = value;
          } else if (element.tagName === "TEXTAREA") {
            element.value = value;
          } else if (element) {
            element.value = value;
          }
        });
      }

      function renderExtracted(info, container) {
        if (!container) return;
        if (!info || Object.keys(info).length === 0) {
          container.textContent = "No se detectó información en este documento.";
          return;
        }
        const template = document.getElementById("extractedTemplate");
        const fragment = template.content.cloneNode(true);
        const list = fragment.querySelector("dl");
        Object.entries(info).forEach(([id, value]) => {
          if (!outputLabels[id]) return;
          const dt = document.createElement("dt");
          dt.textContent = outputLabels[id];
          const dd = document.createElement("dd");
          dd.textContent = value;
          list.append(dt, dd);
        });
        container.innerHTML = "";
        container.appendChild(list);
      }

      function mergeInfo(info) {
        Object.entries(info).forEach(([key, value]) => {
          if (!value) return;
          aggregations[key] = value;
        });
        fillForm(aggregations);
      }

      function handleFile(event, outputId) {
        const file = event.target.files?.[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          const text = typeof reader.result === "string" ? reader.result : "";
          const info = parseDocument(text);
          mergeInfo(info);
          renderExtracted(info, document.getElementById(outputId));
        };

        if (file.type === "application/pdf") {
          reader.readAsText(file);
        } else {
          reader.readAsText(file, "UTF-8");
        }
      }

      document.getElementById("certificateUpload").addEventListener("change", (event) => handleFile(event, "certificateOutput"));
      document.getElementById("representationUpload").addEventListener("change", (event) => handleFile(event, "representationOutput"));

      document.getElementById("submitButton").addEventListener("click", () => {
        const form = document.getElementById("supplierForm");
        const formValid = form?.reportValidity?.() ?? true;
        if (formValid) {
          alert("¡Gracias! La información ha sido registrada (simulación).");
        } else {
          alert("Por favor, complete los campos obligatorios y acepte las declaraciones.");
        }
      });
    </script>
  </body>
</html>
